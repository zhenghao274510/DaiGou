(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/hch-poster/hch-poster"],{"05f8":function(t,e,n){"use strict";var o=n("d761"),a=n.n(o);a.a},"51a5":function(t,e,n){"use strict";(function(t){function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o={data:function(){return{}},props:{canvasFlag:{type:Boolean,default:!0},posterObj:{type:Object,default:{url:"https://data.photo-ac.com/data/thumbnails/2a/2ad5a7429a55956c92f33372cfcd34d6_w.jpeg",text:"苏晓晴",code:"https://img0.zuipin.cn/mp_zuipin/poster/hch-code.png"}}},methods:{roundRect:function(t,e,n,o,a,i,s,c,l){if(t.beginPath(),t.arc(e+i,n+i,i,Math.PI,1.5*Math.PI),t.moveTo(e+i,n),t.lineTo(e+o-i,n),t.arc(e+o-i,n+i,i,1.5*Math.PI,2*Math.PI),t.lineTo(e+o,n+a-i),t.arc(e+o-i,n+a-i,i,0,.5*Math.PI),t.arc(e+i,n+a-i,i,.5*Math.PI,Math.PI),t.lineTo(e,n+i),"btn"==l){var r=t.createLinearGradient(0,0,200,0);r.addColorStop(0,s),r.addColorStop(1,c),t.setFillStyle(r),t.fill()}else s&&(t.setFillStyle(s),t.fill()),c&&(t.setStrokeStyle(c),t.stroke());t.closePath(),t.clip()},canvasMultiLineText:function(t,e,n,o){for(var a=e.split(""),i="",s=[],c=0;c<a.length;c++)t.measureText(i).width<n?i+=e[c]:(c--,s.push(i),i="");if(s.push(i),s.length>o){for(var l=s.slice(0,o),r=l[1],h="",u=[],d=0;d<r.length;d++){if(!(t.measureText(h).width<n))break;h+=r[d]}u.push(h);var f=u[0]+"...";l.splice(o-1,1,f),s=l}return s},codeImg:function(){var e=this;return new Promise(function(o,a){request({method:"get",url:"/spSupport/getwxacodeunlimit",header:{"Content-Type":"application/x-www-form-urlencoded"},data:{version:e.$parent.globalData.version,scene:"sku=".concat(e.sku),page:"pages/product/detail",width:"128px"}}).then(function(e){if(0==e.data.code){var a=wx.getFileSystemManager(),i="tmp_img_src",s="".concat(wx.env.USER_DATA_PATH,"/").concat(i,".jpg");a.writeFile({filePath:s,data:e.data.data,encoding:"binary",success:function(){o(s)},fail:function(){this.canvasFlag=!0,t.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}})}else t.showToast(n({title:e.data.message,icon:"none",duration:2e3},"icon","none"))}).catch(function(){e.canvasFlag=!0,t.showToast({title:"海报生成失败",duration:2e3,icon:"none"})})})},createCanvasImage:function(){console.log(this.posterObj,"posterObj"),console.log("海报生成中"),wx.showLoading({title:"海报生成中..."});var e=this,n=wx.getSystemInfoSync();this.phoneH=n.windowHeight,this.phoneW=n.windowWidth;this.phoneW;var o=this.phoneH/667;console.log(this.phoneH,this.phoneW);var a=wx.createCanvasContext("myCanvas"),i=this.posterObj.url,s=this.posterObj.code;console.log(a),console.log(this),a.draw(),a.save(),this.roundRect(a,60,100,this.phoneW-120,this.phoneH-240,0,"#fff","#fff"),a.restore(),a.save(),wx.getImageInfo({src:i,success:function(t){a.save(),a.drawImage(t.path,60,100,e.phoneW-120,260*o,0),a.restore(),a.draw(!0)},fail:function(){e.canvasFlag=!0,t.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}}),wx.getImageInfo({src:s,success:function(t){a.drawImage(t.path,75,e.phoneH/2+60,60,60),a.draw(!0)},fail:function(){e.canvasFlag=!0,t.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}}),a.setFontSize(14),a.setFillStyle("#111111"),a.font="normal 14px sans-serif",a.fillText("长按识别小程序",e.phoneW/2-40,e.phoneH/2+80,70,70),a.save(),a.setFontSize(14),a.setFillStyle("#FFFFFF"),a.font="normal 14px sans-serif",a.save(),a.setFontSize(14),a.setFillStyle("#333333"),a.font="normal bold 14px sans-serif",a.fillText("分享来自".concat(e.posterObj.text),e.phoneW/2-40,e.phoneH/2+110,90),a.restore(),wx.hideLoading()},saveCanvasImage:function(){console.log("点击了保存"),wx.showLoading({title:"保存中..."});var e=this;t.canvasToTempFilePath({x:50,y:40,width:this.phoneW-100,height:this.phoneH-120,destWidth:5*(this.phoneW-100),destHeight:5*(this.phoneH-120),canvasId:"myCanvas",success:function(n){t.saveImageToPhotosAlbum({filePath:n.tempFilePath,success:function(n){wx.hideLoading(),t.showToast({title:"图片保存成功，可以去分享啦~",duration:2e3}),e.canvasCancelEvn()},fail:function(){t.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"}),wx.hideLoading()}})},fail:function(){t.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"}),wx.hideLoading()}})},canvasCancelEvn:function(){console.log(),this.$emit("cancel",!0)}}};e.default=o}).call(this,n("543d")["default"])},8853:function(t,e,n){"use strict";n.r(e);var o=n("51a5"),a=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,function(){return o[t]})}(i);e["default"]=a.a},d27f:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement;t._self._c},a=[];n.d(e,"a",function(){return o}),n.d(e,"b",function(){return a})},d2d5:function(t,e,n){"use strict";n.r(e);var o=n("d27f"),a=n("8853");for(var i in a)"default"!==i&&function(t){n.d(e,t,function(){return a[t]})}(i);n("05f8");var s=n("2877"),c=Object(s["a"])(a["default"],o["a"],o["b"],!1,null,null,null);e["default"]=c.exports},d761:function(t,e,n){}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/hch-poster/hch-poster-create-component',
    {
        'components/hch-poster/hch-poster-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("d2d5"))
        })
    },
    [['components/hch-poster/hch-poster-create-component']]
]);
